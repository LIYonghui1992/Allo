<include file="Home:nav" />
<div class="fmian" >
	<div class="layout_list" >
 
		<div class="design_main" style="margin-top:30px;">
			
			<!-- display:none; -->
			<div id="msgbox" style="display:none;margin:0px auto;width:1080px;height:50px;margin-top:20px;border:1px solid #e60012;
				background-color:#fff4f9;">
				<div style="width:23px;height:23px;margin-top:15px;margin-left:10px;float:left;">
					<img src="../Public/image/error.jpg" style="width:23px;height:23px;"/>
				</div>
				<div style="height:23px;margin-top:17px;margin-left:15px;float:left;">
					<font id="msg" style="font-size:12px;font-weight:bold;color:#e60012;"></font>
				</div>
				
			</div>
			
			<div id="shipping-2" style="margin:0px auto;width:1080px;height:600px;margin-top:10px;"> 
				
				<div class="shipping-div" style="margin-top:15px;">
					<font style="font-size:14px;font-weight:bold;font-color:#666666;">Your idea</font>
				</div>
				
				<div class="shipping-div"> 
					<div class="shipping-field"><font class="item_font" >Project title*</font></div>
					<input name="project_title" id="project_title" type="text" class="shipping-input"  value="Your project title"  
					onfocus="if (value =='Your project title'){value ='';this.style.color='#333'}" onblur="if (value ==''){value='Your project title';this.style.color='#999'}"/>
				</div>
				
				
				<div class="shipping-div"> 
					<div class="shipping-field"><font class="item_font">Name*</font></div>
					<input name="firstname" id="firstname"  type="text" class="shipping-input" style="width:238px;" value="First Name"
					 onfocus="if (value =='First Name'){value ='';this.style.color='#333'}" onblur="if (value ==''){value='First Name';this.style.color='#999'}" />
					<input name="lastname" type="text" id="lastname" class="shipping-input" style="width:238px; margin-left:10px;" value="Last Name" 
					onfocus="if (value =='Last Name'){value ='';this.style.color='#333'}" onblur="if (value ==''){value='Last Name';this.style.color='#999'}"/>
				</div>
				
				
				<div class="shipping-div">
					<div class="shipping-field"><font class="item_font" >e-mail*</font></div>
					<input name="email" id="email" type="text" class="shipping-input"  value="your e-mail address" 
					onfocus="if (value =='your e-mail address'){value ='';this.style.color='#333'}" onblur="if (value ==''){value='your e-mail address';this.style.color='#999'}"/>
				</div>
				
			
				<div class="shipping-div">
					<div class="shipping-field"><font class="item_font" >Country*</font></div>
					
						<select id="countrylist" class="shipping-input" style="width:512px;" > 
						  <option value="-1">Choose your country</option>
						  
						   <volist name="country_list" id="vo"  >
						   	<option value="{$vo.title}">{$vo.title}</option>
						   </volist>
					  </select>
		
				</div>
				
				<div class="shipping-div">
					<div class="shipping-field"><font class="item_font" >Product image*</font></div>
					<!--
					<input name="product_image" id="product_image" type="text" class="shipping-input" 
					 <empty name="_COOKIE['allocacoc_product_picname']">value="Uploading your product image(840*640px)" style="width:350px;float:left;" <else/> value={$_COOKIE['allocacoc_product_picname']} style="width:350px;float:left;color:#333;" </empty> readonly="readonly"/>
					-->
					<input name="product_image" id="product_image" type="text" class="shipping-input" value="Uploading your product image(840*640px)" style="width:350px;float:left;"  readonly="readonly"/>
					<form id="uploadimg" action={:U('Design/submit_product_pic')}  method="post" enctype="multipart/form-data">
					  <input type="file" id="choosefile5" name="choosefile5" style="display:none;" onchange="javascript:change_product_pic();"/>
					</form>
					<input type="button" class="choose_file" value="choose your file" onclick="javascript:$('#choosefile5').click();"/>
				</div>
				
				<div class="shipping-div" style="height:280px;">	
					<div style="height:30px;width:400px;margin-left:80px;"> best for white background</div>			
					<div class="shipping-input" style="height:213px;width:280px;margin-left:80px;">
					  <div style="height:193px;width:264px;margin-left:2px ;margin-top:6px;border:2px dashed #FFF;position:relative; "> 
							<img id="product_pic" <notempty name="_COOKIE['allocacoc_technical']">src="/design_pics/{$_COOKIE['allocacoc_technical']}" </notempty> style="padding:1px;border:0 #FFF;width:100%;height:100%;<empty name="_COOKIE['allocacoc_technical']">visibility:hidden;</empty>"/>
						  
						  <!--
						  <empty name="_COOKIE['allocacoc_technical']"><div style="position: absolute; z-index: 1;bottom:70px;height:20px;width:100px;left:80px;font-size:14px;color:#878787;">840 X 640 px</div></empty> -->
						</div>						
					</div>
				</div>
		</div>
		
	</div> <!-- design main-->
	
	<div style="width:100%;height:30px;padding:25px 0px;border-top:1px solid #DDD;border-bottom:1px solid #DDD;"> 
		 <div style="width:1080px;margin:0px auto;color:#999;" >
				<div class="shipping-field"><font class="item_font" >Video URL</font></div>
				<input name="video_url" id="video_url" type="text" class="shipping-input" 
				 value=""  style="width:350px;float:left;color:#333;" />
			</div>
				
	</div>
	
	<!-- slider -->
	<div style="width:100%;height:auto;padding:25px 0px;min-height:500px;"> 
		 <div style="width:1080px;margin:0px auto;color:#999;" >
				<div class="shipping-div" style="margin-top:30px;height:300px;width:100%;margin-bottom:30px;">			
					<div class="shipping-field"><font class="item_font" >Product slider*</font></div>
					<div class="shipping-input" style="height:300px;width:900px;margin-left:80px;">
						<div style="height:280px;width:880px;margin-left:4px ;margin-top:6px;border:2px dashed #FFF;"> 
							<img id="slider_demo" style="padding:1px;border:0 #FFF;width:100%;height:100%;visibility:hidden;"/>
						</div>
					</div>
				</div>
				
				<div class="shipping-div" style="height:auto;padding-left:80px;">
					<ul style="width:570px;height:auto;"  id="sliders">
						<li style="height:40px;list-style-type:none;">
  						<div style="width:50px;float:left;color:#999;"><font class="item_font" >slider1</font></div>
  						<input name="slider_filename_1" id="slider_filename_1" type="text" class="shipping-input" 
  					   value="Uploading your image" style="width:350px;float:left;"  readonly="readonly"/>
  					  <input type="file" onchange="javascript:change_slider(this.id);" id="slider_file_1" name="slider_file_1" style="display:none;"/>
  					  <input type="button" class="choose_file" id="slider_button_1" name="slider_button_1" value="choose your file" onclick="javascript:choose_file(this.id);"/> 
					  </li>
					</ul>
					
				</div>
			</div>
				
	</div>
	
	
	
	<!-- feature -->
	<div style="width:100%;height:auto;padding:25px 0px;min-height:500px;"> 
		 <div style="width:1080px;margin:0px auto;color:#999;" >
		 	
		 	 <div  style="margin-left:10px;margin-top:30px;height:144px;width:100%;">			
					
				</div>
				
				<div  style="height:auto;padding-left:80px;width:900px;margin-top:30px;">
					<ul style="width:100%;height:auto;margin-top:30px;"  id="features">
						
					</ul>
					
					<div style="width:150px; height:100px;background-color:#DDD;margin-top:30px;padding-top:40px;" onclick="javascript:add_feature();">
					<div style="width:40px;height:40px;margin:0px auto;"><font style="color:#FFF;font-size:40px;">+</font> </div>
					</div>
					
				</div>
  		
	    </div>
				
	</div>
	
		
  
  <div style="width:100%;height:30px;padding:25px 0px;border-top:1px solid #DDD;"> 
		 <div style="width:1080px;margin:0px auto;color:#999;" >
				<div style="height:50px;width:265px;background-color:transparent;background-image: url(../Public/image/checkout_1.1.png);text-align:center;margin-left:80px;" >
  		    <a href="javascript:submit1();" id="buttonhref"> 
  		  	 <font style="font-size:16px;color:#FFF;line-height:50px;" id="buttontip"> submit your idea</font>
  		    </a> 		
        </div>
			</div>
				
	</div>


	<!--	<include file="Home:bottom" /> -->


	

	<script type="text/javascript">
 	$(document).ready(function()
   {		
    		document.getElementById("pathguide").innerHTML += '<img src="../Public/image/arrow_footer.png" style="margin:3px 2px 0px 0px;"/>'
    		+'<a href="{:U(\'Design/index\')}">'+"{$Think.lang.DESIGN_CHALLENGE}"+'</a>'
    		+'<img src="../Public/image/arrow_footer.png" style="margin:3px 2px 0px 2px;"/>'
    		+'<a>submit your design</a>';
    		
    } );
    
    function change_product_pic()
    {
    	//product_img    	
    	$("#uploadimg").ajaxSubmit({
    			dataType:  'json',
    			
    			success: function(data) { alert('hhhhh');
    				if(data.status==0){
    					alert(data.msg);
    				}
    				if(data.status==1){
    					//alert(data.name);
    					document.getElementById("product_image").value = data.name;
    					document.getElementById("product_image").style.color='#333';	 
    					document.getElementById("product_pic").src = "http://127.0.0.1/design_pics/"+data.pic;
    					document.getElementById("product_pic").style.visibility = "visible";
    				}	
    				
    			},
    			error:function(xhr){
    				alert(xhr.responseText);
    			}
    		});

    }
    
    
    var slidercount = 1;
    var featurecount = 1;
    function change_slider(tempid){
					//alert(tempid.substring(12));
					var eleid = tempid.substring(12); 
					if(slidercount==eleid)
				  {				  	    					 	  
				 	  var filenameid = "slider_filename_"+slidercount;
				 	  var fileid = "slider_file_"+slidercount;
				 	  
				 	  $("#"+fileid).wrap("<form id='myupload"+slidercount+"' action=\"{:U('Design/submit_designidea_pic')}\"  method='post' enctype='multipart/form-data'></form>");
				 	  $("#myupload"+slidercount).ajaxSubmit({
				 	  	dataType:  'json',
				 	  	success: function(data) {
				 	  		if(data.status!=1){
				 	  			alert(data.msg);
				 	  		}
				 	  		if(data.status==1){
        					document.getElementById(filenameid).value = data.name;
        					document.getElementById(filenameid).style.color='#333';	 
        					document.getElementById("slider_demo").src = "http://127.0.0.1/design_pics/"+data.pic;
        					document.getElementById("slider_demo").style.visibility = "visible";
        					
        					nextid = slidercount+1;			  
      				 	  var newNode = document.createElement("li");
      				 	  newNode.style.listStyleType='none';
      				 	  newNode.style.height = '40px';
              		newNode.innerHTML ='<div style="width:50px;float:left;"><font class="item_font" >slider'+nextid+'</font></div>'
              		+'<input name="slider_filename_'+nextid+'" id="slider_filename_'+nextid+'" type="text" class="shipping-input" '
              		+' value="Uploading your image" style="width:350px;float:left;"  readonly="readonly"/>'
              		+' <input type="file" id="slider_file_'+nextid+'" name="slider_file_'+nextid+'" onchange="javascript:change_slider(this.id);" style="display:none;"/>'
              		+' <input type="button" class="choose_file" id="slider_button_'+nextid+'" name="slider_button_'+nextid+'" value="choose your file" onclick="javascript:choose_file(this.id);"/> ';
              		var oldNode = document.getElementById("sliders");   		
              		oldNode.appendChild(newNode); 
              		slidercount ++;  			
    				    }	
    				
    			    },
    			    error:function(xhr){
    				    alert(xhr.responseText);
    			    }
    		    });
				 				 	
				  }
				  else//修改其他的图片
        	{ 
        		
        		var filenameid = "slider_filename_"+eleid;
				 	  var fileid = "slider_file_"+eleid;
				 	  
				 	  $("#myupload"+eleid).ajaxSubmit({
				 	  	dataType:  'json',
				 	  	success: function(data) {
				 	  		if(data.status!=1){
				 	  			alert(data.msg);
				 	  		}
				 	  		if(data.status==1){
        					document.getElementById(filenameid).value = data.name;
        					document.getElementById(filenameid).style.color='#333';	 
        					document.getElementById("slider_demo").src = "http://127.0.0.1/design_pics/"+data.pic;
        					document.getElementById("slider_demo").style.visibility = "visible";  			
    				    }	
    				
    			    },
    			    error:function(xhr){
    				    alert(xhr.responseText);
    			    }
    		    });
    		    
    		   
        	}
		}
		
		function change_feature(tempid){
			var eleid = tempid.substring(13);
			if(featurecount==eleid)
		  {	 	  
		 	  var filenameid = "feature_filename_"+featurecount;
		 	  var fileid = "feature_file_"+featurecount;
		 	  //var divid = "feature_div_"+featurecount;
		 	  
		 	  $("#"+fileid).wrap("<form id='featureupload"+featurecount+"' action=\"{:U('Design/submit_designidea_feature')}\"  method='post' enctype='multipart/form-data'></form>");
		 	  $("#featureupload"+featurecount).ajaxSubmit({
		 	  	dataType:  'json',
		 	  	success: function(data) {
		 	  		if(data.status!=1){
		 	  			alert(data.msg);
		 	  		}
		 	  		if(data.status==1){
    					document.getElementById(filenameid).value = data.name;
    					document.getElementById(filenameid).style.color='#333';	 
    					document.getElementById("feature_pic_"+featurecount).src = "http://127.0.0.1/design_pics/"+data.pic;

    					/*
    					nextid = featurecount+1;			  
  				 	  var newNode = document.createElement("li");
  				 	  newNode.style.listStyleType='none';
  				 	  newNode.style.height = '40px';
          		newNode.innerHTML ='<div style="width:50px;float:left;"><font class="item_font" >slider'+nextid+'</font></div>'
          		+'<input name="slider_filename_'+nextid+'" id="slider_filename_'+nextid+'" type="text" class="shipping-input" '
          		+' value="Uploading your image" style="width:350px;float:left;"  readonly="readonly"/>'
          		+' <input type="file" id="slider_file_'+nextid+'" name="slider_file_'+nextid+'" onchange="javascript:change_slider(this.id);" style="display:none;"/>'
          		+' <input type="button" class="choose_file" id="slider_button_'+nextid+'" name="slider_button_'+nextid+'" value="choose your file" onclick="javascript:choose_file(this.id);"/> ';
          		var oldNode = document.getElementById("sliders");   		
          		oldNode.appendChild(newNode);         		
          		 	
          		*/		
          		//featurecount ++; 
				    }	
				
			    },
			    error:function(xhr){
				    alert(xhr.responseText);
			    }
		    });
		 				 	
		  }
		  else//修改其他的图片
    	{     		
    		var filenameid = "feature_filename_"+eleid;
		 	  var fileid = "feature_file_"+eleid;
		 	  
		 	  $("#featureupload"+eleid).ajaxSubmit({
		 	  	dataType:  'json',
		 	  	success: function(data) {
		 	  		if(data.status!=1){
		 	  			alert(data.msg);
		 	  		}
		 	  		if(data.status==1){
    					document.getElementById(filenameid).value = data.name;
    					document.getElementById(filenameid).style.color='#333';	 
    					document.getElementById("feature_pic_"+eleid).src = "http://127.0.0.1/design_pics/"+data.pic;
    					//document.getElementById("slider_demo").style.visibility = "visible";  			
				    }	
				
			    },
			    error:function(xhr){
				    alert(xhr.responseText);
			    }
		    });
		    
		   
    	}
		}
		
			
			function choose_file(fileid)
			{ 
				curr_id = fileid.substring(14);
				document.getElementById("slider_file_"+curr_id).click();  
			}
			
			function feature_choose_file(fileid)
			{ 
				curr_id = fileid.substring(15);
				document.getElementById("feature_file_"+curr_id).click();  
			}
			
			
			function submit1()
			{
				//alert(getFeatureText());return false;
				//hide error msg first
				document.getElementById("msg").innerHTML ='';
				document.getElementById("msgbox").style.display="none"; 
					 
				//check general input				
				if(!check_general_input())
				{
					scrollTo(400,300);
					 return false;
				}
				
				var url = "{:U('Design/submit_designidea')}";
				
				var data =  { 
					project_title: document.getElementById("project_title").value, 
					firstname: document.getElementById("firstname").value,
					lastname: document.getElementById("lastname").value,
					email: document.getElementById("email").value,
					countryid: document.getElementById("countrylist").value,
					//product_image ,in cookie
					video_url:document.getElementById("video_url").value,
					//slider,in cookie
					//feature, pic in cookie, text, need processing
					feature_text_list:getFeatureText(),
					};
					
					
					document.getElementById("buttonhref").href='#';
					document.getElementById("buttontip").innerHTML='processing';

				$.post(url,data,function(data){

							if(data.status == 1){							

								//alert('succ');
								
								var window_height = $(window).height();
      					if(window_height<800)
      					{
      						maxHeight=window_height*0.7;
      						_top=0;
      						_width='80%';
      					}else{
      						maxHeight='600px';
      						_top='115px';
      						_width='60%';
      					}
					
								art.dialog({
									title: 'Congratulations!',
									content: 'already submit',
									 lock:true,
									 width: _width,
									 top:_top,
									 style:'succeed noClose',
									 okVal: 'OK',
									 ok:function(){
										window.location = '/Design/index'; 
										}
							 } );
								
							}else{
								document.getElementById("buttonhref").href='javascript:submit1();';
								document.getElementById("buttontip").innerHTML='submit your idea';
								document.getElementById("msg").innerHTML = data.msg;
								document.getElementById("msgbox").style.display="block"; 
								scrollTo(400,300); //alert(data.msg);													
							}
						},"json"); 
						
			}
			
			
			function check_general_input()
			{
				
				if(document.getElementById("project_title").value=='' || document.getElementById("project_title").value== 'Your project title')
				{
					 document.getElementById("msg").innerHTML ='project title cannot be empty!';
					 document.getElementById("msgbox").style.display="block"; 
					 return false;
				}
				if(document.getElementById("firstname").value=='' || document.getElementById("firstname").value== 'First Name')
				{
					 document.getElementById("msg").innerHTML ='First Name cannot be empty!';
					 document.getElementById("msgbox").style.display="block"; 
					 return false;
				}
				if(document.getElementById("lastname").value=='' || document.getElementById("lastname").value== 'Last Name')
				{
					 document.getElementById("msg").innerHTML ='Last Name cannot be empty!';
					 document.getElementById("msgbox").style.display="block"; 
					 return false;
				}
				if(document.getElementById("email").value=='' || document.getElementById("email").value== 'your e-mail address')
				{
					 document.getElementById("msg").innerHTML ='your e-mail address cannot be empty!';
					 document.getElementById("msgbox").style.display="block"; 
					 return false;
				}
				if (!(/^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/.test(document.getElementById("email").value))) {
								document.getElementById("msg").innerHTML = 'Please enter a valid mailbox!';
								document.getElementById("msgbox").style.display="block"; 
								return false;
				}
							
				if(document.getElementById("countrylist").value==-1)
				{ 
					document.getElementById("msg").innerHTML = 'Please choose your country!';
					document.getElementById("msgbox").style.display="block"; 
					return false;
				}
				
				if(document.getElementById("product_image").value=='' || document.getElementById("product_image").value== 'Uploading close-up of key features')
				{
					 document.getElementById("msg").innerHTML ='product image cannot be empty!';
					 document.getElementById("msgbox").style.display="block"; 
					 return false;
				}
				
				//check slider
				if(slidercount<=1)
				{
					 document.getElementById("msg").innerHTML ='slider cannot be empty!';
					 document.getElementById("msgbox").style.display="block"; 
					 return false;
				}
				//check feature
				if(featurecount<=1)
				{
					 document.getElementById("msg").innerHTML ='feature cannot be empty!';
					 document.getElementById("msgbox").style.display="block"; 
					 return false;
				}
				
				return true;
			}
			
			function getFeatureText()
			{
				var list='';
				var oFeature = document.getElementsByTagName('textarea');
				for (var i = 0; i < oFeature.length; i++) 
				{
					if(oFeature[i].className =='feature_text')
					{
						//if(oFeature[i].value=='')
						  list = list + oFeature[i].value + ',';
					}
					//alert(oFeature[i].value);
				}
				
				return list;
			}
			
			
			function bk_add_feature()
			{
				nextid = featurecount + 1;
				
				
				var newNode = document.createElement("li");
		 	  newNode.style.listStyleType='none';
		 	  newNode.style.height = '200px';
		 	  newNode.style.width = '100%';
    		newNode.innerHTML ='<img class="feature_pic" id="feature_pic_'+ nextid +'"/>'
    		+'<textarea class="feature_text" id="feature_text_' +nextid+ '"></textarea> '
    		+'<input name="feature_filename_'+nextid+'" id="feature_filename_'+nextid+'" type="text" class="shipping-input" '
  			+	' value="Uploading your image" style="width:140px;float:left;margin-top:7px;"  readonly="readonly"/>'
    		+'<input type="file" onchange="javascript:change_feature(this.id);" id="feature_file_'+nextid+'" name="feature_file_'+nextid+'" style="display:none;"/>'
    		+' <input type="button" class="choose_file" style="width:83px;margin-top:7px;margin-left:3px;" id="feature_button_'+nextid+'" name="feature_button_'+nextid+'" value="choose file" onclick="javascript:feature_choose_file(this.id);"/> ';
    		
    		var oldNode = document.getElementById("features");   		
    		oldNode.appendChild(newNode); 
    		
    		
    		/*
    		var newhtml = '<li style="height:200px;list-style-type:none;width:100%;">'
    		+'<img class="feature_pic" id="feature_pic_'+ nextid +'"/>'
    		+'<textarea class="feature_text" id="feature_text_' +nextid+ '"></textarea> '
    		+'<input name="feature_filename_'+nextid+'" id="feature_filename_'+nextid+'" type="text" class="shipping-input" '
  			+	' value="Uploading your image" style="width:140px;float:left;margin-top:7px;"  readonly="readonly"/>'
    		+'<input type="file" onchange="javascript:change_feature(this.id);" id="feature_file_'+nextid+'" name="feature_file_'+nextid+'" style="display:none;"/>'
    		+' <input type="button" class="choose_file" style="width:83px;margin-top:7px;margin-left:3px;" id="feature_button_'+nextid+'" name="feature_button_'+nextid+'" value="choose file" onclick="javascript:feature_choose_file(this.id);"/> '
    		
    		+'</li>';
    		document.getElementById("features").innerHTML += newhtml;
    		*/
    		featurecount ++;  	
    					
			}
			
			function add_feature()
			{
				nextid = featurecount + 1;
				
				
				var newNode = document.createElement("li");
		 	  newNode.style.listStyleType='none';
		 	  newNode.style.height = '200px';
		 	  newNode.style.width = '100%';
    		newNode.innerHTML =' <div style="width:83px;margin-top:7px;margin-left:3px;height:50px;">sss </div> ';
    		
    		var oldNode = document.getElementById("features");   		
    		oldNode.appendChild(newNode); 
    		
    		
    		featurecount ++;  	
    					
			}

			
		</script>
		
			
					
		
		<style type="text/css">		
		.shipping-div{float:left;margin-left:10px;width:600px;padding-top:5px;margin-bottom:5px;color:#999;height:40px;}
		.shipping-field{width:80px;float:left;}
		.shipping-input{padding-left:10px;height:30px;margin:0px auto;width:500px;margin-left:0px;border:1px solid #CCC;
			font-size:12px;color:#999999;background-color:#EEE;}
		
		.choose_file{padding-left:10px;height:30px;margin:0px auto;width:140px;margin-left:10px;border:1px solid #CCC;
			font-size:12px;float:left;color:#FFF;background:#15869f;}
		.item_font{font-size:12px;min-width:50px;		}
		.feature_text{padding:10px;border:1px solid #CCC;background-color:#EEE;width:620px;float:left;margin-left:20px;height:124px;}
		.feature_pic{padding:1px;border:0 #FFF;width:236px;height:144px;float:left;}
		</style>
		